<!DOCTYPE html>
<html>
<head>
  <title>node-gtfs example</title>
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://code.leafletjs.com/leaflet-0.5/leaflet.ie.css">
  <![endif]-->

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen">
</head>
<body>

  <div class="container">

    <div class="btn-group" id="top-menu">
        <a class="btn" href="#" id="all-agencies">All Agencies</a>
        <a class="btn" id="agencies-by-location">Agencies by location</a>
        <a class="btn" id="routes-by-location">Routes by location</a>
        <a class="btn" id="stops-by-location">Stops by location</a>
    </div>

    <div class="navigation">
      <button class="btn" id="nav-button" style="display:none"><i class="icon-arrow-left"></i> Back</button>
    </div>

    <button class="btn" id="getShape">get Shape</button>

    <h1 id="pageTitle">Agencies</h1>

    <form id="locationForm" class="form-inline form-search">
      <fieldset class="control-group">
        <label for="location">Location: </label>
        <input type="text" name="location" class="span2" id="location">
        <button class="btn" id="getLoc">Current location</button>
      </fieldset>
      <label for="radius">Radius: </label>
      <select id="radius">
        <option value="1">1 mile</option>
        <option value="5">5 miles</option>
        <option value="10">10 miles</option>
        <option value="25" selected>25 miles</option>
        <option value="100">100 miles</option>
      </select>
      <input type="submit" value="Find Agencies" class="btn btn-primary">
    </form>

    <div id="map"></div>

    <div id="data"></div>

    <div id="shapeOutput"></div>
    <style>
      #shapeOutput i{
        position: absolute;
        display: block;
        font-size: 2px;
        -webkit-transition: all 0.2s;
      }
    </style>

    <footer>
      <a href="https://github.com/brendannee/node-gtfs">View on Github</a>
    </footer>

  </div> <!-- /container -->


  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
  <script src="js/script.js"></script>
  <script>
    //get Agencies on pageload
    $(document).ready(function(){
      getAgencies();
    });
  </script>

  <!-- Geolocation -->

  <script>

      var position = {};

      $(window).ready(function(){
          $("#getLoc").click(initiate_geolocation);
      });

      function initiate_geolocation() {
          if (position.coords == null) {
            navigator.geolocation.getCurrentPosition(handle_geolocation_query,handle_errors);
          }
          else {
            handle_geolocation_query(position);
          }
      }
      function handle_errors(error)
      {
          switch(error.code)
          {
              case error.PERMISSION_DENIED: alert("user did not share geolocation data");
              break;
              case error.POSITION_UNAVAILABLE: alert("could not detect current position");
              break;
              case error.TIMEOUT: alert("retrieving position timed out");
              break;
              default: alert("unknown error");
              break;
          }
      }
      function handle_geolocation_query(pos){
          // alert('Lat: ' + position.coords.latitude +
          //       ' Lon: ' + position.coords.longitude);
          position = pos;
          updateMapGeo(position.coords.latitude, position.coords.longitude);
      }

      function updateMapGeo(lat,lon) {
          var lat = lat
            , lon = lon
            , radius = $('#radius').val();

          switch($('#locationForm').attr('data-form-type')){
            case 'agencies':
              getAgenciesNearby(lat, lon, radius);
              break;
            case 'routes':
              getRoutesNearby(lat, lon, radius);
              break;
            case 'stops':
              getStopsNearby(lat, lon, radius);
              break;
          }
      }
  </script>

  <!-- end Geolocation -->

</body>
</html>
