<!DOCTYPE html>
<html>
<head>
  <title>Ript times</title>
  <link rel="stylesheet" href="css/loader.css" type="text/css" media="screen">
</head>
<body>

  <nav>
    <input id="timeslide" type="range" min="0" max="1440" value="0" step="1"/>
    <span id="current-time">0</span>
    <div class="ajax-loader spinner"></div>
  </nav>

  <div class="container">

  </div>

  <div class="alltrips">

  </div>



    <style>
      html {
        height: 100%;
      }
      body {
        background: #f4f4f4;
        font-family: Apercu Mono;
      }

      #timeslide {
        -webkit-appearance:none;
        width: 100%;
        background: white;
        border-radius: 10px;
        height: 10px;
        border: 1px solid red;
      }

      #timeslide::-webkit-slider-thumb {
        -webkit-appearance:none;
        border-radius: 50%;
        height: 20px;
        width: 20px;
        background: red;
      }

      #current-time {
        font-size: 20px;
        z-index: -999;
      }

      nav {
        position: fixed;
        top: 10px;
        left: 10px;
        text-align: right;
        right: 10px;
        z-index: 9;
      }

      .container {
        padding-top: 60px;
      }

      .alltrips {
        padding: 60px;
        position: fixed;
        top: 0px;
        background: white;
        overflow: scroll;
        bottom: 0;
        right: 0;
        width: 50%;
      }

      .alltrips b {
        font-weight: normal;
        font-size: 10px;
      }

      .alltrips .state {
        height: 16px;
        text-align: right;
        padding: 10px;
        color: red;
      }

      .spinner {
        display: none;
      }

      .loading .spinner {
        display: block;
      }

    </style>

  <div id="zoom-style">
  </div>


  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <!-- <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="js/simplify.min.js"></script> -->
  <script>

    function timeChange(){
      hr = parseInt(this.value / 60);
      min = this.value - hr*60;
      sec = 00;

      if (sec < 10 ) sec = "0" + sec;
      if (min < 10 ) min = "0" + min;
      if (hr  < 10 ) hr  = "0" + hr;

      if (hr == 0) hr = 24;

      time = hr+":"+min+":"+sec;
      $("#current-time").html(time);
      getStopsNow(time)
      //mapObj.zoom(this.value);
    }

    function getStopsNow(time_str){
      $.getJSON('/api/thistime/ripta/' + time_str + '/', function(data){
        if(data.length){
          var list = []
          $(".container").append("<b>At time "+time_str+"</b><br>");
          data.forEach(function(stoptime){
            list.push("<b>"+time_str+":</b> "+getHeadSign(stoptime.trip_id)+" makes its "+stoptime.stop_sequence+"th stop at location "+stoptime.stop_id+"<br>");
            $("#"+stoptime.trip_id+" .state").html(stoptime.stop_sequence);
          });
          $(".container").html(list);
        } else {
          $(".container").html("<b>"+time_str+":</b> Nothing now");
        }
      });
    }

    trips = [];

    function getAllTrips(callback){
      $.getJSON('/api/alltrips/ripta/', function(data){
        if(data.length){
          //console.log(data);
          data.forEach(function(trip){
            trips.push(trip);
            $(".alltrips").append("<div class=\".trip\" id="+trip.trip_id+"><b>"+trip.trip_id+"</b><span class=\"state\"></span></div>");
          });
          callback();
        } else {
          console.log("no trips");
        }
      });
    }

    function getHeadSign(tripid) {
      var result = $.grep(trips, function(e){ return e.trip_id == tripid; });
      return result[0].trip_headsign;
    }

    function setup() {
      getAllTrips(bind);
      function bind() {
        $('#timeslide').change(timeChange);
        $('#timeslide').change();
      }
    }

    setup();

  </script>

</body>
</html>
